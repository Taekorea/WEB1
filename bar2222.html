<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Html-Qrcode Demo</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="baco.js"></script>
</head>
<body>
    <div id="qr-reader" style="width: 350px"></div>
    <div id="qr-reader-results"></div>
    <form id="fm" method="get" action="http://lovelikelove.ipdisk.co.kr:8000/bar.php">
        <li>
            <label for="A">바코드번호</label><br>
            <input type="tel" name="A" id="AA" style="width: 350px; height: 40px; font-size: 30px; color: red;">
        </li>
        <div align="center">
            <button type="button" onclick="submitForm()" style="width: 130px; height: 30px;">
                <font size="4pt" color="black">등록하기</font>
            </button>
        </div>
    </form>
    <div>시약 개봉 폐기용</div>

    <script>
        function submitForm() {
            var decodedText = document.getElementById('AA').value;

            $.ajax({
                type: "GET",
                url: "http://lovelikelove.ipdisk.co.kr:8000/bar.php",
                data: { A: decodedText },
                success: function (response) {
                    // 성공 시 처리
                    console.log("Form submitted successfully:", response);
                },
                error: function (error) {
                    // 오류 시 처리
                    console.error("Error submitting form:", error);
                }
            });
        }

        function docReady(fn) {
            if (document.readyState === "complete" || document.readyState === "interactive") {
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        }

        docReady(function () {
            var resultContainer = document.getElementById('qr-reader-results');
            var lastResult, countResults = 0;

            function onScanSuccess(decodedText, decodedResult) {
                if (decodedText !== lastResult) {
                    ++countResults;
                    lastResult = decodedText;
                    console.log(`Scan result ${decodedText}`, decodedResult);

                    document.getElementById('AA').value = decodedText;
                    // $('#fm').submit(); // 이 부분을 주석처리하고 직접 submitForm 함수 호출
                    submitForm();
                }
            }

            var html5QrcodeScanner = new Html5QrcodeScanner(
                "qr-reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);
        });
    </script>
</body>
</html>

